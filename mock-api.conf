# ========================================================================================
# MOCK API CONFIGURATION FOR FQGE TESTING
# ========================================================================================
# Purpose: Nginx configuration file for mock API service used in FQGE Stage B testing
# This provides simulated API endpoints for functional testing without external dependencies
#
# Server: Nginx web server
# Port: 80 (HTTP)
# Purpose: Simulate REST API responses for order management system
# Used by: stageB.sh for API availability and response validation
# ========================================================================================

server {
    # ====================================================================================
    # SERVER CONFIGURATION
    # ====================================================================================
    listen 80;                    # Listen on HTTP port 80
    server_name localhost;         # Accept requests for localhost

    # ====================================================================================
    # ENDPOINT: /api/status - HEALTH CHECK ENDPOINT
    # ====================================================================================
    # Purpose: Health check endpoint for API availability validation
    # Used by: stageB.sh to verify API service is running
    # Returns: HTTP 200 with JSON health status
    # ====================================================================================
    location /api/status {
        return 200 '{"status": "healthy", "timestamp": "2024-01-01T00:00:00Z"}';
        add_header Content-Type application/json;
    }

    # ====================================================================================
    # ENDPOINT: /api/order - ORDER MANAGEMENT ENDPOINT
    # ====================================================================================
    # Purpose: Simulate order creation API for functional testing
    # Used by: stageB.sh to test POST operations and response handling
    # Methods:
    #   POST: Creates new order (returns 201 with order details)
    #   Other: Returns 405 Method Not Allowed
    # ====================================================================================
    location /api/order {
        # Handle POST requests for order creation
        if ($request_method = POST) {
            return 201 '{"id": 1001, "status": "created", "message": "Order created successfully"}';
            add_header Content-Type application/json;
        }
        # Reject all other HTTP methods
        return 405 'Method Not Allowed';
    }

    # ====================================================================================
    # DEFAULT LOCATION: CATCH-ALL FOR UNDEFINED ENDPOINTS
    # ====================================================================================
    # Purpose: Handle requests to undefined endpoints
    # Returns: HTTP 404 with JSON error message
    # ====================================================================================
    location / {
        return 404 '{"error": "Not Found"}';
        add_header Content-Type application/json;
    }
}

# ========================================================================================
# CONFIGURATION NOTES:
# - All responses include proper Content-Type headers for JSON
# - Status endpoint always returns healthy (for testing purposes)
# - Order endpoint simulates successful order creation
# - Default location handles undefined routes gracefully
# ========================================================================================